<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@k-platform/core documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">@k-platform/core documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >MediaService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>lib/common/media/media.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p><code>MediaService</code> is a service responsible for managing media files, including
uploading, resizing, optimizing, and removing images.</p>

            </p>

            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                            <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
            </p>


            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#createBasicFindQb" >createBasicFindQb</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#createMediaDirectory" >createMediaDirectory</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#createMediaEntity" >createMediaEntity</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#createMediaFileEntity" >createMediaFileEntity</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#createOrUpdateMedia" >createOrUpdateMedia</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findByCode" >findByCode</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findMediaById" >findMediaById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findPrivateById" >findPrivateById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#findPublicById" >findPublicById</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getFormatsToProcess" >getFormatsToProcess</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#getMediaPath" >getMediaPath</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getMediaType" >getMediaType</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getOriginalFormat" >getOriginalFormat</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getPngQualityRange" >getPngQualityRange</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getPrivateDir" >getPrivateDir</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getPublicDir" >getPublicDir</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#getThumbFormat" >getThumbFormat</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#optimizeImage" >optimizeImage</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#processFormats" >processFormats</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#recreate" >recreate</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#remove" >remove</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#resizeImage" >resizeImage</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(logger: Logger, mediaRep: <a href="../interfaces/Media.html" target="_self">Repository&lt;MediaEntity&gt;</a>, mediaTypeRep: <a href="../entitys/MediaTypeEntity.html" target="_self">Repository&lt;MediaTypeEntity&gt;</a>, mediaFormatRep: <a href="../entitys/MediaFormatEntity.html" target="_self">Repository&lt;MediaFormatEntity&gt;</a>, mediaFileRep: <a href="../classes/FileEntity.html" target="_self">Repository&lt;MediaFileEntity&gt;</a>, cacheService: <a href="../classes/CacheService.html" target="_self">CacheService</a>, metadataService: <a href="../classes/FileMd.html" target="_self">FileMd</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="64" class="link-to-prism">lib/common/media/media.service.ts:64</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>logger</td>
                                                  
                                                        <td>
                                                                    <code>Logger</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>mediaRep</td>
                                                  
                                                        <td>
                                                                        <code><a href="../interfaces/Media.html" target="_self" >Repository&lt;MediaEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>mediaTypeRep</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/MediaTypeEntity.html" target="_self" >Repository&lt;MediaTypeEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>mediaFormatRep</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/MediaFormatEntity.html" target="_self" >Repository&lt;MediaFormatEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>mediaFileRep</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/FileEntity.html" target="_self" >Repository&lt;MediaFileEntity&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>cacheService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/CacheService.html" target="_self" >CacheService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>metadataService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../classes/FileMd.html" target="_self" >FileMd</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createBasicFindQb"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>createBasicFindQb</b></span>
                        <a href="#createBasicFindQb"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createBasicFindQb()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="567"
                                    class="link-to-prism">lib/common/media/media.service.ts:567</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a basic query builder for finding media entities.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                        </div>
                            <div class="io-description">
                                <p>The created query builder.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createMediaDirectory"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>createMediaDirectory</b></span>
                        <a href="#createMediaDirectory"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createMediaDirectory(mediaType: <a href="../entitys/MediaTypeEntity.html" target="_self">MediaTypeEntity</a>, mediaEntityId: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="361"
                                    class="link-to-prism">lib/common/media/media.service.ts:361</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a media directory for the given media type and media entity ID.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>mediaType</td>
                                            <td>
                                                            <code><a href="../entitys/MediaTypeEntity.html" target="_self" >MediaTypeEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaTypeEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>mediaEntityId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The media entity ID.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;string&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>The path to the created media directory.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createMediaEntity"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>createMediaEntity</b></span>
                        <a href="#createMediaEntity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createMediaEntity(mediaType: <a href="../entitys/MediaTypeEntity.html" target="_self">MediaTypeEntity</a>, metadata?: <a href="../entitys/FileMetadataEntity.html" target="_self">FileMetadataEntity</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="344"
                                    class="link-to-prism">lib/common/media/media.service.ts:344</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a new media entity with the provided media type.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>mediaType</td>
                                            <td>
                                                            <code><a href="../entitys/MediaTypeEntity.html" target="_self" >MediaTypeEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaTypeEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>metadata</td>
                                            <td>
                                                            <code><a href="../entitys/FileMetadataEntity.html" target="_self" >FileMetadataEntity</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                            <td>
                                                    <ul>
<li>The metadata of media file.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The created MediaEntity instance.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createMediaFileEntity"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>createMediaFileEntity</b></span>
                        <a href="#createMediaFileEntity"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createMediaFileEntity(image: Buffer, format: <a href="../entitys/MediaFormatEntity.html" target="_self">MediaFormatEntity</a>, mediaEntity: <a href="../classes/MediaEntity.html" target="_self">MediaEntity</a>, fileName: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="546"
                                    class="link-to-prism">lib/common/media/media.service.ts:546</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Creates a MediaFileEntity instance for the provided image, format, media entity, and file name.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>image</td>
                                            <td>
                                                        <code>Buffer</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The image buffer.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>format</td>
                                            <td>
                                                            <code><a href="../entitys/MediaFormatEntity.html" target="_self" >MediaFormatEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaFormatEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>mediaEntity</td>
                                            <td>
                                                            <code><a href="../classes/MediaEntity.html" target="_self" >MediaEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>fileName</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The file name.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../classes/FileEntity.html" target="_self" >Promise&lt;MediaFileEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The created MediaFileEntity instance.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createOrUpdateMedia"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>createOrUpdateMedia</b></span>
                        <a href="#createOrUpdateMedia"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createOrUpdateMedia(file: Buffer, type: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, code?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, existedEntityId?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, name?: <a href="../interfaces/LocalizedString.html" target="_self">LocalizedString[]</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:205</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Uploads and processes a media file, create or update related entity.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>file</td>
                                            <td>
                                                        <code>Buffer</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>Buffer of media file.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>type</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The media type.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>code</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                            <td>
                                                    <ul>
<li>Specific identification code for media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>existedEntityId</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                            <td>
                                                    <ul>
<li>ID of media entity for patch.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>name</td>
                                            <td>
                                                            <code><a href="../interfaces/LocalizedString.html" target="_self" >LocalizedString[]</a></code>
                                            </td>

                                            <td>
                                                    Yes
                                            </td>


                                            <td>
                                                    <ul>
<li>localized name for media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The uploaded and processed media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findByCode"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findByCode</b></span>
                        <a href="#findByCode"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findByCode(code: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:86</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Finds a media entity by code.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>code</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The code of the media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The found media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findMediaById"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findMediaById</b></span>
                        <a href="#findMediaById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findMediaById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, privateMedia: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:306</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Finds a media entity by ID with the specified access level (public or private).</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The ID of the media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>privateMedia</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>undefined</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>A boolean flag indicating whether to search for private media entities (default: false).</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The found media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findPrivateById"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findPrivateById</b></span>
                        <a href="#findPrivateById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findPrivateById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:106</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Finds a media entity by ID with private access.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ID of the media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The found private media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="findPublicById"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>findPublicById</b></span>
                        <a href="#findPublicById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>findPublicById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:97</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Finds a media entity by ID with public access.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ID of the media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The found media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getFormatsToProcess"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getFormatsToProcess</b></span>
                        <a href="#getFormatsToProcess"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getFormatsToProcess(mediaType: <a href="../entitys/MediaTypeEntity.html" target="_self">MediaTypeEntity</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="380"
                                    class="link-to-prism">lib/common/media/media.service.ts:380</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves the media formats that need to be processed for the given media type.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>mediaType</td>
                                            <td>
                                                            <code><a href="../entitys/MediaTypeEntity.html" target="_self" >MediaTypeEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaTypeEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../entitys/MediaFormatEntity.html" target="_self" >Promise&lt;MediaFormatEntity[]&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>An array of MediaFormatEntity instances to be processed.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMediaPath"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>getMediaPath</b></span>
                        <a href="#getMediaPath"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getMediaPath(media: <a href="../interfaces/Media.html" target="_self">Media</a>, format, webpSupport)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:283</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Get the media file path based on the media object, format, and WebP support.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Default value</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>media</td>
                                            <td>
                                                            <code><a href="../interfaces/Media.html" target="_self" >Media</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                            </td>

                                            <td>
                                                    <ul>
<li>The media object to get the file path for.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>format</td>
                                            <td>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>ReservedMediaFormat.ORIGINAL</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>The format of the media file (default is &#39;ORIGINAL&#39;).</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>webpSupport</td>
                                            <td>
                                            </td>

                                            <td>
                                                    No
                                            </td>

                                            <td>
                                                    <code>false</code>
                                            </td>

                                            <td>
                                                    <ul>
<li>A boolean indicating whether the client supports WebP format (default is false).</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The full path to the media file including the file extension.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getMediaType"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getMediaType</b></span>
                        <a href="#getMediaType"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getMediaType(type: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="327"
                                    class="link-to-prism">lib/common/media/media.service.ts:327</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves the media type based on the given type code.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>type</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The media type code.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../entitys/MediaTypeEntity.html" target="_self" >Promise&lt;MediaTypeEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The MediaTypeEntity instance.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getOriginalFormat"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getOriginalFormat</b></span>
                        <a href="#getOriginalFormat"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getOriginalFormat()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="608"
                                    class="link-to-prism">lib/common/media/media.service.ts:608</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves media format for files originals.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The MediaFormatEntity instance representing the original format.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPngQualityRange"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>getPngQualityRange</b></span>
                        <a href="#getPngQualityRange"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getPngQualityRange(quality: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="494"
                                    class="link-to-prism">lib/common/media/media.service.ts:494</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves the PNG quality range based on the provided quality value.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>quality</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The image quality.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPrivateDir"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getPrivateDir</b></span>
                        <a href="#getPrivateDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getPrivateDir()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="598"
                                    class="link-to-prism">lib/common/media/media.service.ts:598</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves the path to the private media directory stored in configuration.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The normalized path to the private media directory.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getPublicDir"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getPublicDir</b></span>
                        <a href="#getPublicDir"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getPublicDir()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="588"
                                    class="link-to-prism">lib/common/media/media.service.ts:588</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves the path to the public media directory stored in configuration.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The normalized path to the public media directory.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getThumbFormat"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>getThumbFormat</b></span>
                        <a href="#getThumbFormat"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getThumbFormat()</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="618"
                                    class="link-to-prism">lib/common/media/media.service.ts:618</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Retrieves media format for files thumbnails.</p>
</div>

                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The MediaFormatEntity instance representing the thumbnail format.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="optimizeImage"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>optimizeImage</b></span>
                        <a href="#optimizeImage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>optimizeImage(buffer: Buffer, fileExt: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>, quality: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="464"
                                    class="link-to-prism">lib/common/media/media.service.ts:464</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Optimizes the image based on the provided file extension and quality.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>buffer</td>
                                            <td>
                                                        <code>Buffer</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The image buffer.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>fileExt</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The file extension.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>quality</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The image quality.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>unknown</code>

                        </div>
                            <div class="io-description">
                                <p>The optimized image buffer.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="processFormats"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>processFormats</b></span>
                        <a href="#processFormats"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>processFormats(file: Buffer, formats: <a href="../entitys/MediaFormatEntity.html" target="_self">MediaFormatEntity[]</a>, mediaType: <a href="../entitys/MediaTypeEntity.html" target="_self">MediaTypeEntity</a>, mediaEntity: <a href="../classes/MediaEntity.html" target="_self">MediaEntity</a>, outputPath: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="405"
                                    class="link-to-prism">lib/common/media/media.service.ts:405</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Processes the media formats for a given file, media type, and media entity.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>file</td>
                                            <td>
                                                        <code>Buffer</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The deserialized media file.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>formats</td>
                                            <td>
                                                            <code><a href="../entitys/MediaFormatEntity.html" target="_self" >MediaFormatEntity[]</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The media formats to process.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>mediaType</td>
                                            <td>
                                                            <code><a href="../entitys/MediaTypeEntity.html" target="_self" >MediaTypeEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaTypeEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>mediaEntity</td>
                                            <td>
                                                            <code><a href="../classes/MediaEntity.html" target="_self" >MediaEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>outputPath</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The output path for the processed files.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../classes/FileEntity.html" target="_self" >Promise&lt;MediaFileEntity[]&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>An array of MediaFileEntity instances.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="recreate"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>recreate</b></span>
                        <a href="#recreate"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>recreate(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:160</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Recreate a media entity, generate new files and data.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ID of the media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The recreated media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="remove"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>remove</b></span>
                        <a href="#remove"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>remove(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Inherited from         <code><a href="../classes/MediaManager.html" target="_self" >MediaManager</a></code>
</div>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../classes/MediaManager.html#source" target="_self" >MediaManager:115</a></code>
</div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Removes a media entity by ID and cleans up related files.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>id</td>
                                            <td>
                                                            <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The ID of the media entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>        <code><a href="../interfaces/Media.html" target="_self" >Promise&lt;MediaEntity&gt;</a></code>

                        </div>
                            <div class="io-description">
                                <p>The removed media entity.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="resizeImage"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Async</span>
                        <span ><b>resizeImage</b></span>
                        <a href="#resizeImage"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>resizeImage(buffer: Buffer, format: <a href="../entitys/MediaFormatEntity.html" target="_self">MediaFormatEntity</a>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="506"
                                    class="link-to-prism">lib/common/media/media.service.ts:506</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>Resizes the image based on the provided media format.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>buffer</td>
                                            <td>
                                                        <code>Buffer</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The image buffer.</li>
</ul>

                                            </td>
                                        </tr>
                                        <tr>
                                                <td>format</td>
                                            <td>
                                                            <code><a href="../entitys/MediaFormatEntity.html" target="_self" >MediaFormatEntity</a></code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The MediaFormatEntity instance.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;Buffer&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>The resized image buffer.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  BadRequestException,
  Inject,
  Injectable,
  InternalServerErrorException,
  Logger,
  NotFoundException,
} from &quot;@nestjs/common&quot;;
import { Repository } from &quot;typeorm&quot;;
import { InjectRepository } from &quot;@nestjs/typeorm&quot;;
import { FilesUtils } from &quot;../../shared/utils/files.utils&quot;;
import { Media, MediaManager } from &quot;./media.types&quot;;
import { LOGGER } from &quot;../../shared/modules/log/log.constants&quot;;
import { MediaEntity } from &quot;./entity/media.entity&quot;;
import { MediaTypeEntity } from &quot;./entity/media-type.entity&quot;;
import { MediaFormatEntity } from &quot;./entity/media-format.entity&quot;;
import { MediaFileEntity } from &quot;./entity/media-file.entity&quot;;
import { CacheService } from &quot;../../shared/modules/cache/cache.types&quot;;
import { FileMd } from &quot;../file/file.constants&quot;;
import {
  DEFAULT_MEDIA_QUALITY,
  MEDIA_TYPE_RELATIONS,
  ReservedMediaExt,
  ReservedMediaFormat,
} from &quot;./media.constants&quot;;
import { LocalizedString } from &quot;../../shared/modules/locale/locale.types&quot;;
import { LocalizedStringEntity } from &quot;../../shared/modules/locale/entity/localized-string.entity&quot;;
import { FileMetadataEntity } from &quot;../file/entity/file-metadata.entity&quot;;
import { NumberUtils } from &quot;../../shared/utils/number.utils&quot;;
import { MediaConfig } from &quot;../../../gen-src/media.config&quot;;
import * as imageminMozjpeg from &quot;imagemin-mozjpeg&quot;;
import { createCanvas } from &quot;canvas&quot;; // fix canvas compatibility with Windows OS
import * as sharp from &quot;sharp&quot;;
import * as imagemin from &quot;imagemin&quot;;
import * as fs from &quot;fs&quot;;
import * as path from &quot;path&quot;;
import * as heicConvert from &quot;heic-convert&quot;;
import imageminPngquant from &quot;imagemin-pngquant&quot;;

createCanvas(0, 0); // crutch for canvas lib
import createDirectoriesIfNotExist &#x3D; FilesUtils.createDirectoriesIfNotExist;

/**
 * &#x60;MediaService&#x60; is a service responsible for managing media files, including
 * uploading, resizing, optimizing, and removing images.
 */
@Injectable()
export class MediaService extends MediaManager {
  constructor(
    @Inject(LOGGER) protected readonly logger: Logger,
    @InjectRepository(MediaEntity)
    private readonly mediaRep: Repository&lt;MediaEntity&gt;,
    @InjectRepository(MediaTypeEntity)
    private readonly mediaTypeRep: Repository&lt;MediaTypeEntity&gt;,
    @InjectRepository(MediaFormatEntity)
    private readonly mediaFormatRep: Repository&lt;MediaFormatEntity&gt;,
    @InjectRepository(MediaFileEntity)
    private readonly mediaFileRep: Repository&lt;MediaFileEntity&gt;,
    private readonly cacheService: CacheService,
    private readonly metadataService: FileMd,
  ) {
    super();
  }

  /**
   * Finds a media entity by code.
   * @param code - The code of the media entity.
   * @returns The found media entity.
   */
  async findByCode(code: string): Promise&lt;MediaEntity&gt; {
    return await this.createBasicFindQb()
      .where(&quot;media.code &#x3D; :code&quot;, { code })
      .getOne();
  }

  /**
   * Finds a media entity by ID with public access.
   * @param id - The ID of the media entity.
   * @returns The found media entity.
   */
  async findPublicById(id: number): Promise&lt;MediaEntity&gt; {
    return this.findMediaById(id, false);
  }

  /**
   * Finds a media entity by ID with private access.
   * @param id - The ID of the media entity.
   * @returns The found private media entity.
   */
  async findPrivateById(id: number): Promise&lt;MediaEntity&gt; {
    return this.findMediaById(id, true);
  }

  /**
   * Removes a media entity by ID and cleans up related files.
   * @param id - The ID of the media entity.
   * @returns The removed media entity.
   */
  async remove(id: number): Promise&lt;MediaEntity&gt; {
    const media &#x3D; await this.findMediaById(id);
    const dir &#x3D; path.join(
      media.type.private
        ? await this.getPrivateDir()
        : await this.getPublicDir(),
      media.id.toString(),
    );
    await this.mediaRep.manager.transaction(async (transactionManager) &#x3D;&gt; {
      await transactionManager.remove(media.files);
      await transactionManager.remove(media);
      if (media.metadata) {
        if (media.metadata.gps) {
          await transactionManager.remove(media.metadata.gps);
        }
        if (media.metadata.image) {
          await transactionManager.remove(media.metadata.image);
        }
        if (media.metadata.icc) {
          await transactionManager.remove(media.metadata.icc);
        }
        if (media.metadata.exif) {
          await transactionManager.remove(media.metadata.exif);
        }
      }
      await fs.promises
        .rm(dir, { recursive: true, force: true })
        .catch((err) &#x3D;&gt; {
          throw new InternalServerErrorException(
            &#x60;Failed to delete directory: ${dir}&#x60;,
            err,
          );
        });
    });
    this.logger.log(&#x60;Media with ID ${id} removed&#x60;);
    return media;
  }

  /**
   * Recreate a media entity, generate new files and data.
   * @param id - The ID of the media entity.
   * @returns The recreated media entity.
   * @throws NotFoundException if the media entity is not found.
   * @throws BadRequestException if the related media is not found.
   */
  async recreate(id: number): Promise&lt;MediaEntity&gt; {
    const media &#x3D; await this.findMediaById(id);
    if (!media) {
      throw new NotFoundException(&#x60;Media with ID ${id} not found&#x60;);
    }
    const dir &#x3D; path.join(
      media.type.private
        ? await this.getPrivateDir()
        : await this.getPublicDir(),
      media.id.toString(),
    );
    this.logger.log(&#x60;Try to recreate media with ID ${id}&#x60;);
    for (const file of media.files) {
      if (file.format.code !&#x3D;&#x3D; ReservedMediaFormat.ORIGINAL) {
        continue;
      }
      const oldFilePath &#x3D; path.normalize(
        &#x60;${dir}/${file.name}.${media.type.ext.code}&#x60;,
      );
      if (!fs.existsSync(oldFilePath)) {
        throw new BadRequestException(&#x60;Related file was not found&#x60;);
      }
      const oldFile &#x3D; await fs.promises.readFile(oldFilePath);
      const newMedia &#x3D; await this.createOrUpdateMedia(
        oldFile,
        media.type.code,
        media.code,
        media.id,
      );
      this.logger.log(&#x60;Media with ID ${id} recreated&#x60;);
      return newMedia;
    }
    this.logger.error(&#x60;Media with ID ${id} not recreated&#x60;);
    return media;
  }

  /**
   * Uploads and processes a media file, create or update related entity.
   * @param file - Buffer of media file.
   * @param type - The media type.
   * @param code - Specific identification code for media entity.
   * @param existedEntityId - ID of media entity for patch.
   * @param name - localized name for media entity.
   * @returns The uploaded and processed media entity.
   */
  async createOrUpdateMedia(
    file: Buffer,
    type: string,
    code?: string,
    existedEntityId?: number,
    name?: LocalizedString[],
  ): Promise&lt;MediaEntity&gt; {
    const fileMetadata &#x3D;
      await this.metadataService.createFileMetadataEntity(file);
    const mediaType &#x3D; await this.getMediaType(type);
    if (fileMetadata.ext &#x3D;&#x3D;&#x3D; &quot;heic&quot;) {
      // convert heic to target format
      if (mediaType.ext.code !&#x3D;&#x3D; &quot;png&quot; &amp;&amp; mediaType.ext.code !&#x3D;&#x3D; &quot;jpg&quot;) {
        throw new BadRequestException(
          &#x60;Can&#x27;t convert input file to ${mediaType.ext.code}&#x60;,
        );
      }
      file &#x3D; await heicConvert({
        buffer: file,
        format: mediaType.ext.code &#x3D;&#x3D;&#x3D; &quot;jpg&quot; ? &quot;JPEG&quot; : &quot;PNG&quot;,
      });
    }
    let entity: MediaEntity &#x3D; undefined;
    await this.mediaRep.manager.transaction(async (transactionManager) &#x3D;&gt; {
      if (existedEntityId) {
        entity &#x3D; await this.findMediaById(existedEntityId);
        if (!entity) {
          throw new BadRequestException(
            &#x60;Cannot patch media with ID ${existedEntityId}, because that not exists&#x60;,
          );
        }
        const dir &#x3D; path.join(
          entity.type.private
            ? await this.getPrivateDir()
            : await this.getPublicDir(),
          entity.id.toString(),
        );
        await fs.promises
          .rm(dir, { recursive: true, force: true })
          .catch((err) &#x3D;&gt; {
            throw new InternalServerErrorException(
              &#x60;Failed to delete directory: ${dir}&#x60;,
              err,
            );
          });
      } else {
        entity &#x3D; await this.createMediaEntity(mediaType, fileMetadata);
      }
      entity.name &#x3D; name as LocalizedStringEntity[];
      entity.code &#x3D; code;
      const outputPath &#x3D; await this.createMediaDirectory(
        mediaType,
        entity.id.toString(),
      );
      const formatsToProcess &#x3D; await this.getFormatsToProcess(mediaType);
      entity.files &#x3D; await this.processFormats(
        file,
        formatsToProcess,
        mediaType,
        entity,
        outputPath,
      );
      await transactionManager.save(entity);
    });
    this.logger.log(
      &#x60;${!existedEntityId ? &#x60;Created&#x60; : &#x60;Updated&#x60;} media with ID ${entity.id}&#x60;,
    );
    entity.files.forEach((f) &#x3D;&gt; delete f.media); // remove inverse side ref
    return entity;
  }

  /**
   * Get the media file path based on the media object, format, and WebP support.
   * @param media - The media object to get the file path for.
   * @param format - The format of the media file (default is &#x27;ORIGINAL&#x27;).
   * @param webpSupport - A boolean indicating whether the client supports WebP format (default is false).
   * @returns The full path to the media file including the file extension.
   */
  async getMediaPath(
    media: Media,
    format &#x3D; ReservedMediaFormat.ORIGINAL,
    webpSupport &#x3D; false,
  ) {
    let mediaPath &#x3D; &#x60;${media.type.private ? await this.getPrivateDir() : await this.getPublicDir()}/${media.id}/&#x60;;
    const file &#x3D; media.files.find((v) &#x3D;&gt; v.format.code &#x3D;&#x3D;&#x3D; format);
    mediaPath +&#x3D; file.name;
    if (webpSupport &amp;&amp; media.type.vp6) {
      mediaPath +&#x3D; &quot;.webp&quot;;
    } else {
      mediaPath +&#x3D; &#x60;.${media.type.ext.code}&#x60;;
    }
    return mediaPath;
  }

  /**
   * Finds a media entity by ID with the specified access level (public or private).
   * @param id - The ID of the media entity.
   * @param privateMedia - A boolean flag indicating whether to search for private media entities (default: false).
   * @returns The found media entity.
   * @throws NotFoundException if the media entity is not found.
   */
  async findMediaById(
    id: number,
    privateMedia: boolean &#x3D; undefined,
  ): Promise&lt;MediaEntity&gt; {
    const qb &#x3D; this.createBasicFindQb().where(&quot;media.id &#x3D; :id&quot;, { id });
    if (privateMedia !&#x3D;&#x3D; undefined) {
      qb.andWhere(&#x60;type.private &#x3D; ${privateMedia}&#x60;);
    }
    const entity &#x3D; await qb.getOne();
    if (!entity) {
      throw new NotFoundException(&#x60;Media with ID ${id} not found&#x60;);
    }
    return entity;
  }

  /**
   * Retrieves the media type based on the given type code.
   * @param type - The media type code.
   * @returns The MediaTypeEntity instance.
   * @throws BadRequestException if the media type is not found.
   */
  private async getMediaType(type: string): Promise&lt;MediaTypeEntity&gt; {
    const mediaType &#x3D; await this.mediaTypeRep.findOne({
      where: { code: type },
      relations: MEDIA_TYPE_RELATIONS,
    });
    if (!mediaType) {
      throw new BadRequestException(&quot;Media type not found&quot;);
    }
    return mediaType;
  }

  /**
   * Creates a new media entity with the provided media type.
   * @param mediaType - The MediaTypeEntity instance.
   * @param metadata - The metadata of media file.
   * @returns The created MediaEntity instance.
   */
  private async createMediaEntity(
    mediaType: MediaTypeEntity,
    metadata?: FileMetadataEntity,
  ): Promise&lt;MediaEntity&gt; {
    const entity &#x3D; new MediaEntity();
    entity.name &#x3D; [];
    entity.type &#x3D; mediaType;
    entity.metadata &#x3D; metadata;
    return this.mediaRep.save(entity);
  }

  /**
   * Creates a media directory for the given media type and media entity ID.
   * @param mediaType - The MediaTypeEntity instance.
   * @param mediaEntityId - The media entity ID.
   * @returns The path to the created media directory.
   */
  private async createMediaDirectory(
    mediaType: MediaTypeEntity,
    mediaEntityId: string,
  ): Promise&lt;string&gt; {
    const dir &#x3D; path.join(
      mediaType.private
        ? await this.getPrivateDir()
        : await this.getPublicDir(),
      mediaEntityId,
    );
    await createDirectoriesIfNotExist(dir);
    return dir;
  }

  /**
   * Retrieves the media formats that need to be processed for the given media type.
   * @param mediaType - The MediaTypeEntity instance.
   * @returns An array of MediaFormatEntity instances to be processed.
   */
  private async getFormatsToProcess(
    mediaType: MediaTypeEntity,
  ): Promise&lt;MediaFormatEntity[]&gt; {
    mediaType.formats &#x3D; mediaType.formats.filter(
      (f) &#x3D;&gt;
        f.code !&#x3D;&#x3D; ReservedMediaFormat.ORIGINAL &amp;&amp;
        f.code !&#x3D;&#x3D; ReservedMediaFormat.THUMB,
    );
    const thumbFormat &#x3D; await this.getThumbFormat();
    const originalFormat &#x3D; await this.getOriginalFormat();
    if (mediaType.ext.code &#x3D;&#x3D;&#x3D; ReservedMediaExt.SVG) {
      return [originalFormat, ...mediaType.formats];
    }
    return [thumbFormat, originalFormat, ...mediaType.formats];
  }

  /**
   * Processes the media formats for a given file, media type, and media entity.
   * @param file - The deserialized media file.
   * @param formats - The media formats to process.
   * @param mediaType - The MediaTypeEntity instance.
   * @param mediaEntity - The MediaEntity instance.
   * @param outputPath - The output path for the processed files.
   * @returns An array of MediaFileEntity instances.
   */
  private async processFormats(
    file: Buffer,
    formats: MediaFormatEntity[],
    mediaType: MediaTypeEntity,
    mediaEntity: MediaEntity,
    outputPath: string,
  ): Promise&lt;MediaFileEntity[]&gt; {
    const processingPromises &#x3D; formats.map(async (format) &#x3D;&gt; {
      const quality &#x3D; mediaType.quality || DEFAULT_MEDIA_QUALITY;
      let imgBuffer &#x3D; file;
      if (
        format.code !&#x3D;&#x3D; ReservedMediaFormat.ORIGINAL &amp;&amp;
        mediaType.ext.code !&#x3D;&#x3D; ReservedMediaExt.SVG
      ) {
        imgBuffer &#x3D; await this.resizeImage(file, format);
        imgBuffer &#x3D; await this.optimizeImage(
          imgBuffer,
          mediaType.ext.code,
          quality,
        );
      }
      const fileName &#x3D; &#x60;${NumberUtils.generateRandomInt()}-${format.code}&#x60;;
      const resizedImagePath &#x3D; &#x60;${outputPath}/${fileName}.${mediaType.ext.code}&#x60;;
      await fs.promises.writeFile(resizedImagePath, imgBuffer);
      const resizedMediaFile &#x3D; await this.createMediaFileEntity(
        imgBuffer,
        format,
        mediaEntity,
        fileName,
      );
      if (mediaType.vp6) {
        const webpImage &#x3D; await sharp(imgBuffer).webp({ quality }).toBuffer();
        const webpImagePath &#x3D; &#x60;${outputPath}/${fileName}.webp&#x60;;
        await fs.promises.writeFile(webpImagePath, webpImage);
        const webpMediaFile &#x3D; await this.createMediaFileEntity(
          webpImage,
          format,
          mediaEntity,
          fileName,
        );
        return [
          await this.mediaFileRep.save(resizedMediaFile),
          await this.mediaFileRep.save(webpMediaFile),
        ];
      } else {
        return [await this.mediaFileRep.save(resizedMediaFile)];
      }
    });
    const savedMediaFiles &#x3D; await Promise.all(processingPromises);
    return savedMediaFiles.flat();
  }

  /**
   * Optimizes the image based on the provided file extension and quality.
   * @param buffer - The image buffer.
   * @param fileExt - The file extension.
   * @param quality - The image quality.
   * @returns The optimized image buffer.
   */
  private async optimizeImage(
    buffer: Buffer,
    fileExt: string,
    quality: number,
  ) {
    try {
      switch (fileExt) {
        case &quot;png&quot;:
          return await imagemin.buffer(buffer, {
            plugins: [
              imageminPngquant({ quality: this.getPngQualityRange(quality) }),
            ],
          });
        case &quot;jpg&quot;:
        case &quot;jpeg&quot;:
          return await imagemin.buffer(buffer, {
            plugins: [imageminMozjpeg({ quality })],
          });
      }
    } catch (e) {
      this.logger.error(&#x60;Image-optimize error&#x60;, e);
      return buffer;
    }
  }

  /**
   * Retrieves the PNG quality range based on the provided quality value.
   * @param quality - The image quality.
   * @returns A tuple containing the minimum and maximum quality values.
   */
  private getPngQualityRange(quality: number): [number, number] {
    const minQuality &#x3D; Math.max(0, quality - 10) / 100;
    const maxQuality &#x3D; Math.min(100, quality + 10) / 100;
    return [minQuality, maxQuality];
  }

  /**
   * Resizes the image based on the provided media format.
   * @param buffer - The image buffer.
   * @param format - The MediaFormatEntity instance.
   * @returns The resized image buffer.
   */
  private async resizeImage(
    buffer: Buffer,
    format: MediaFormatEntity,
  ): Promise&lt;Buffer&gt; {
    const originalMetadata &#x3D; await sharp(buffer).metadata();
    const originalWidth &#x3D; originalMetadata.width;
    const originalHeight &#x3D; originalMetadata.height;
    let targetWidth: number | null &#x3D; parseInt(format.width) || null;
    let targetHeight: number | null &#x3D; parseInt(format.height) || null;
    if (targetWidth &gt; originalWidth) {
      targetWidth &#x3D; originalWidth;
    }
    if (targetHeight &gt; originalHeight) {
      targetHeight &#x3D; originalHeight;
    }
    if (!targetWidth &amp;&amp; !targetHeight) {
      targetWidth &#x3D; originalWidth;
      targetHeight &#x3D; originalHeight;
    } else if (targetWidth &amp;&amp; !targetHeight) {
      targetHeight &#x3D; Math.round((originalHeight / originalWidth) * targetWidth);
    } else if (!targetWidth &amp;&amp; targetHeight) {
      targetWidth &#x3D; Math.round((originalWidth / originalHeight) * targetHeight);
    } else {
      const widthRatio &#x3D; targetWidth / originalWidth;
      const heightRatio &#x3D; targetHeight / originalHeight;
      const minRatio &#x3D; Math.min(widthRatio, heightRatio);
      targetWidth &#x3D; Math.round(originalWidth * minRatio);
      targetHeight &#x3D; Math.round(originalHeight * minRatio);
    }
    return await sharp(buffer).resize(targetWidth, targetHeight).toBuffer();
  }

  /**
   * Creates a MediaFileEntity instance for the provided image, format, media entity, and file name.
   * @param image - The image buffer.
   * @param format - The MediaFormatEntity instance.
   * @param mediaEntity - The MediaEntity instance.
   * @param fileName - The file name.
   * @returns The created MediaFileEntity instance.
   */
  private async createMediaFileEntity(
    image: Buffer,
    format: MediaFormatEntity,
    mediaEntity: MediaEntity,
    fileName: string,
  ): Promise&lt;MediaFileEntity&gt; {
    const metadata &#x3D; await sharp(image).metadata();
    const mediaFile &#x3D; new MediaFileEntity();
    mediaFile.name &#x3D; fileName;
    mediaFile.format &#x3D; format;
    mediaFile.media &#x3D; mediaEntity;
    mediaFile.width &#x3D; metadata.width;
    mediaFile.height &#x3D; metadata.height;
    mediaFile.size &#x3D; image.length;
    return mediaFile;
  }

  /**
   * Creates a basic query builder for finding media entities.
   * @returns The created query builder.
   */
  private createBasicFindQb() {
    return this.mediaRep
      .createQueryBuilder(&quot;media&quot;)
      .leftJoinAndSelect(&quot;media.type&quot;, &quot;type&quot;)
      .leftJoinAndSelect(&quot;media.metadata&quot;, &quot;metadata&quot;)
      .leftJoinAndSelect(&quot;metadata.image&quot;, &quot;metaImage&quot;)
      .leftJoinAndSelect(&quot;metadata.gps&quot;, &quot;metaGps&quot;)
      .leftJoinAndSelect(&quot;metadata.icc&quot;, &quot;metaIcc&quot;)
      .leftJoinAndSelect(&quot;metadata.exif&quot;, &quot;metaExif&quot;)
      .leftJoinAndSelect(&quot;type.formats&quot;, &quot;formats&quot;)
      .leftJoinAndSelect(&quot;type.ext&quot;, &quot;ext&quot;)
      .leftJoinAndSelect(&quot;media.files&quot;, &quot;files&quot;)
      .leftJoinAndSelect(&quot;files.format&quot;, &quot;format&quot;)
      .leftJoinAndSelect(&quot;media.name&quot;, &quot;name&quot;)
      .leftJoinAndSelect(&quot;name.lang&quot;, &quot;lang&quot;);
  }

  /**
   * Retrieves the path to the public media directory stored in configuration.
   * @returns The normalized path to the public media directory.
   */
  private async getPublicDir() {
    const dir &#x3D;
      process.cwd() + (await this.cacheService.get(MediaConfig.PUBLIC_DIR));
    return path.normalize(dir);
  }

  /**
   * Retrieves the path to the private media directory stored in configuration.
   * @returns The normalized path to the private media directory.
   */
  private async getPrivateDir() {
    const dir &#x3D;
      process.cwd() + (await this.cacheService.get(MediaConfig.PRIVATE_DIR));
    return path.normalize(dir);
  }

  /**
   * Retrieves media format for files originals.
   * @returns The MediaFormatEntity instance representing the original format.
   */
  private async getOriginalFormat() {
    return await this.mediaFormatRep.findOne({
      where: { code: ReservedMediaFormat.ORIGINAL },
    });
  }

  /**
   * Retrieves media format for files thumbnails.
   * @returns The MediaFormatEntity instance representing the thumbnail format.
   */
  private async getThumbFormat() {
    return await this.mediaFormatRep.findOne({
      where: { code: ReservedMediaFormat.THUMB },
    });
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'MediaService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
