<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>@k-platform/core documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">@k-platform/core documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >LocaleSubscriber</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>lib/shared/modules/locale/entity/locale-subscriber.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>LocaleSubscriber is an EntitySubscriber that listens to removal events
for entities that have relationships with LocalizedStringEntity or LocalizedMediaEntity.
When such an entity is removed, LocaleSubscriber will also remove
the associated LocalizedStringEntity or LocalizedMediaEntity instances.</p>
<b>Example :</b><div><pre class="line-numbers"><code class="language-html">class MyEntity {
  &#64;ManyToMany(() =&gt; LocalizedStringEntity, { cascade: true })
  &#64;JoinTable()
  firstName: LocalizedStringEntity[];
}</code></pre></div><p>const myEntity = new MyEntity();
entityManager.remove(myEntity); // will trigger LocaleSubscriber to remove related LocalizedStringEntity instances</p>

            </p>



            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#afterRemove" >afterRemove</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(logger: Logger, dataSource: DataSource)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="47" class="link-to-prism">lib/shared/modules/locale/entity/locale-subscriber.ts:47</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div class="io-description"><p>Constructs a new LocaleSubscriber instance.</p>
</div>
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                                    <td>Description</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>logger</td>
                                                  
                                                        <td>
                                                                    <code>Logger</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <ul>
<li>The Logger instance used for logging messages.</li>
</ul>

                                                        </td>
                                                </tr>
                                                <tr>
                                                        <td>dataSource</td>
                                                  
                                                        <td>
                                                                    <code>DataSource</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                        <td>
                                                                <ul>
<li>The DataSource instance used to access the connection and its subscribers.</li>
</ul>

                                                        </td>
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="afterRemove"></a>
                    <span class="name">
                            <span class="modifier">Async</span>
                        <span ><b>afterRemove</b></span>
                        <a href="#afterRemove"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>afterRemove(event: RemoveEvent<any>)</code>
                </td>
            </tr>


                    <tr>
                        <td class="col-md-4">
                            <div class="io-line">Defined in <a href="" data-line="69"
                                    class="link-to-prism">lib/shared/modules/locale/entity/locale-subscriber.ts:69</a></div>
                        </td>
                    </tr>


            <tr>
                <td class="col-md-4">
                        <div class="io-description"><p>The afterRemove event is triggered when an entity is removed.
If the removed entity has relationships with LocalizedStringEntity instances,
the related LocalizedStringEntity instances will also be removed.</p>
</div>

                            <div class="io-description">
                                <b>Parameters :</b>
                                
                                <table class="params">
                                    <thead>
                                        <tr>
                                            <td>Name</td>
                                                <td>Type</td>
                                            <td>Optional</td>
                                                <td>Description</td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                                <td>event</td>
                                            <td>
                                                        <code>RemoveEvent&lt;any&gt;</code>
                                            </td>

                                            <td>
                                                    No
                                            </td>


                                            <td>
                                                    <ul>
<li>The RemoveEvent instance containing information about the removed entity.</li>
</ul>

                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        <div class="io-description">
                            <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                        </div>
                            <div class="io-description">
                                <p>A Promise that resolves when the removal of related LocalizedStringEntity instances is complete.</p>

                            </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  DataSource,
  EntitySubscriberInterface,
  EventSubscriber,
  RemoveEvent,
} from &quot;typeorm&quot;;
import { Inject, Injectable, Logger } from &quot;@nestjs/common&quot;;
import { InjectDataSource } from &quot;@nestjs/typeorm&quot;;
import { LOGGER } from &quot;../../log/log.constants&quot;;
import { LocalizedStringEntity } from &quot;./localized-string.entity&quot;;
import { LocalizedMediaEntity } from &quot;./localized-media.entity&quot;;

/**
 * LocaleSubscriber is an EntitySubscriber that listens to removal events
 * for entities that have relationships with LocalizedStringEntity or LocalizedMediaEntity.
 * When such an entity is removed, LocaleSubscriber will also remove
 * the associated LocalizedStringEntity or LocalizedMediaEntity instances.
 *
 * @example
 * class MyEntity {
 *   @ManyToMany(() &#x3D;&gt; LocalizedStringEntity, { cascade: true })
 *   @JoinTable()
 *   firstName: LocalizedStringEntity[];
 * }
 *
 * const myEntity &#x3D; new MyEntity();
 * entityManager.remove(myEntity); // will trigger LocaleSubscriber to remove related LocalizedStringEntity instances
 */
@Injectable()
@EventSubscriber()
export class LocaleSubscriber implements EntitySubscriberInterface {
  /**
   * Constructs a new LocaleSubscriber instance.
   *
   * @param logger - The Logger instance used for logging messages.
   * @param dataSource - The DataSource instance used to access the connection and its subscribers.
   */
  constructor(
    @Inject(LOGGER) protected readonly logger: Logger,
    @InjectDataSource() private readonly dataSource: DataSource,
  ) {
    dataSource.manager.connection.subscribers.push(this);
  }

  /**
   * The afterRemove event is triggered when an entity is removed.
   * If the removed entity has relationships with LocalizedStringEntity instances,
   * the related LocalizedStringEntity instances will also be removed.
   *
   * @param event - The RemoveEvent instance containing information about the removed entity.
   * @returns A Promise that resolves when the removal of related LocalizedStringEntity instances is complete.
   */
  async afterRemove(event: RemoveEvent&lt;any&gt;): Promise&lt;void&gt; {
    const entity &#x3D; event.entity;
    if (!entity) {
      return;
    }
    const localizedStringProperties &#x3D; Object.values(entity).filter((value) &#x3D;&gt; {
      return (
        Array.isArray(value) &amp;&amp;
        value.length &gt; 0 &amp;&amp;
        value[0] instanceof LocalizedStringEntity
      );
    });
    if (localizedStringProperties.length &gt; 0) {
      this.logger.verbose(
        &#x60;Removing related LocalizedStringEntity entities for ${entity.constructor.name} with ID ${event.entityId}&#x60;,
      );
      for (const relatedEntities of localizedStringProperties as LocalizedStringEntity[][]) {
        for (const relatedEntity of relatedEntities) {
          this.logger.verbose(
            &#x60;Removing LocalizedStringEntity with ID ${relatedEntity.id}&#x60;,
          );
          await event.manager.remove(relatedEntity);
          this.logger.verbose(
            &#x60;LocalizedStringEntity with ID ${relatedEntity.id} removed&#x60;,
          );
        }
      }
    }

    const localizedMediaProperties &#x3D; Object.values(entity).filter((value) &#x3D;&gt; {
      return (
        Array.isArray(value) &amp;&amp;
        value.length &gt; 0 &amp;&amp;
        value[0] instanceof LocalizedMediaEntity
      );
    });
    if (localizedMediaProperties.length &gt; 0) {
      this.logger.verbose(
        &#x60;Removing related LocalizedMediaEntity entities for ${entity.constructor.name} with ID ${event.entityId}&#x60;,
      );
      for (const relatedEntities of localizedMediaProperties as LocalizedMediaEntity[][]) {
        for (const relatedEntity of relatedEntities) {
          this.logger.verbose(
            &#x60;Removing LocalizedMediaEntity with ID ${relatedEntity.id}&#x60;,
          );
          await event.manager.remove(relatedEntity);
          this.logger.verbose(
            &#x60;LocalizedMediaEntity with ID ${relatedEntity.id} removed&#x60;,
          );
        }
      }
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'LocaleSubscriber.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
